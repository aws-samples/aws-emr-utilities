#!/bin/bash
HOSTNAME=`hostname -f`
sudo yum install -y mod_ssl
sudo mv /etc/httpd/conf.d/ssl.conf /home/hadoop/ssl.conf_original
sudo unzip -o /usr/share/aws/emr/security/workingdir/tls-artifacts.zip -d /etc/ssl/certs/

#Dynamicportfordwarding ssl.conf
sudo echo IwojIFdoZW4gd2UgYWxzbyBwcm92aWRlIFNTTCB3ZSBoYXZlIHRvIGxpc3RlbiB0byB0aGUKIyB0aGUgSFRUUFMgcG9ydCBpbiBhZGRpdGlvbi4KIwpMaXN0ZW4gMTk0NDMgaHR0cHMKI0xpc3RlbiA0NDMgaHR0cHMKIyMKIyMgIFNTTCBHbG9iYWwgQ29udGV4dAojIwojIyAgQWxsIFNTTCBjb25maWd1cmF0aW9uIGluIHRoaXMgY29udGV4dCBhcHBsaWVzIGJvdGggdG8KIyMgIHRoZSBtYWluIHNlcnZlciBhbmQgYWxsIFNTTC1lbmFibGVkIHZpcnR1YWwgaG9zdHMuCiMjCiMgICBQYXNzIFBocmFzZSBEaWFsb2c6CiMgICBDb25maWd1cmUgdGhlIHBhc3MgcGhyYXNlIGdhdGhlcmluZyBwcm9jZXNzLgojICAgVGhlIGZpbHRlcmluZyBkaWFsb2cgcHJvZ3JhbSAoYGJ1aWx0aW4nIGlzIGEgaW50ZXJuYWwKIyAgIHRlcm1pbmFsIGRpYWxvZykgaGFzIHRvIHByb3ZpZGUgdGhlIHBhc3MgcGhyYXNlIG9uIHN0ZG91dC4KU1NMUGFzc1BocmFzZURpYWxvZyBleGVjOi91c3IvbGliZXhlYy9odHRwZC1zc2wtcGFzcy1kaWFsb2cKIyAgIEludGVyLVByb2Nlc3MgU2Vzc2lvbiBDYWNoZToKIyAgIENvbmZpZ3VyZSB0aGUgU1NMIFNlc3Npb24gQ2FjaGU6IEZpcnN0IHRoZSBtZWNoYW5pc20KIyAgIHRvIHVzZSBhbmQgc2Vjb25kIHRoZSBleHBpcmluZyB0aW1lb3V0IChpbiBzZWNvbmRzKS4KU1NMU2Vzc2lvbkNhY2hlICAgICAgICAgc2htY2I6L3J1bi9odHRwZC9zc2xjYWNoZSg1MTIwMDApClNTTFNlc3Npb25DYWNoZVRpbWVvdXQgIDMwMAojICAgUHNldWRvIFJhbmRvbSBOdW1iZXIgR2VuZXJhdG9yIChQUk5HKToKIyAgIENvbmZpZ3VyZSBvbmUgb3IgbW9yZSBzb3VyY2VzIHRvIHNlZWQgdGhlIFBSTkcgb2YgdGhlCiMgICBTU0wgbGlicmFyeS4gVGhlIHNlZWQgZGF0YSBzaG91bGQgYmUgb2YgZ29vZCByYW5kb20gcXVhbGl0eS4KIyAgIFdBUk5JTkchIE9uIHNvbWUgcGxhdGZvcm1zIC9kZXYvcmFuZG9tIGJsb2NrcyBpZiBub3QgZW5vdWdoIGVudHJvcHkKIyAgIGlzIGF2YWlsYWJsZS4gVGhpcyBtZWFucyB5b3UgdGhlbiBjYW5ub3QgdXNlIHRoZSAvZGV2L3JhbmRvbSBkZXZpY2UKIyAgIGJlY2F1c2UgaXQgd291bGQgbGVhZCB0byB2ZXJ5IGxvbmcgY29ubmVjdGlvbiB0aW1lcyAoYXMgbG9uZyBhcwojICAgaXQgcmVxdWlyZXMgdG8gbWFrZSBtb3JlIGVudHJvcHkgYXZhaWxhYmxlKS4gQnV0IHVzdWFsbHkgdGhvc2UKIyAgIHBsYXRmb3JtcyBhZGRpdGlvbmFsbHkgcHJvdmlkZSBhIC9kZXYvdXJhbmRvbSBkZXZpY2Ugd2hpY2ggZG9lc24ndAojICAgYmxvY2suIFNvLCBpZiBhdmFpbGFibGUsIHVzZSB0aGlzIG9uZSBpbnN0ZWFkLiBSZWFkIHRoZSBtb2Rfc3NsIFVzZXIKIyAgIE1hbnVhbCBmb3IgbW9yZSBkZXRhaWxzLgpTU0xSYW5kb21TZWVkIHN0YXJ0dXAgZmlsZTovZGV2L3VyYW5kb20gIDI1NgpTU0xSYW5kb21TZWVkIGNvbm5lY3QgYnVpbHRpbgojU1NMUmFuZG9tU2VlZCBzdGFydHVwIGZpbGU6L2Rldi9yYW5kb20gIDUxMgojU1NMUmFuZG9tU2VlZCBjb25uZWN0IGZpbGU6L2Rldi9yYW5kb20gIDUxMgojU1NMUmFuZG9tU2VlZCBjb25uZWN0IGZpbGU6L2Rldi91cmFuZG9tIDUxMgojCiMgVXNlICJTU0xDcnlwdG9EZXZpY2UiIHRvIGVuYWJsZSBhbnkgc3VwcG9ydGVkIGhhcmR3YXJlCiMgYWNjZWxlcmF0b3JzLiBVc2UgIm9wZW5zc2wgZW5naW5lIC12IiB0byBsaXN0IHN1cHBvcnRlZAojIGVuZ2luZSBuYW1lcy4gIE5PVEU6IElmIHlvdSBlbmFibGUgYW4gYWNjZWxlcmF0b3IgYW5kIHRoZQojIHNlcnZlciBkb2VzIG5vdCBzdGFydCwgY29uc3VsdCB0aGUgZXJyb3IgbG9ncyBhbmQgZW5zdXJlCiMgeW91ciBhY2NlbGVyYXRvciBpcyBmdW5jdGlvbmluZyBwcm9wZXJseS4KIwpTU0xDcnlwdG9EZXZpY2UgYnVpbHRpbgojU1NMQ3J5cHRvRGV2aWNlIHVic2VjCiMjCiMjIFNTTCBWaXJ0dWFsIEhvc3QgQ29udGV4dAojIwo8VmlydHVhbEhvc3QgKjoxOTQ0Mz4KU2VydmVyTmFtZSBzZXJ2ZXJob3N0bmFtZQpTU0xFbmdpbmUgb24KU1NMQ2VydGlmaWNhdGVDaGFpbkZpbGUgL2V0Yy9zc2wvY2VydHMvdHJ1c3RlZENlcnRpZmljYXRlcy5wZW0KU1NMQ2VydGlmaWNhdGVLZXlGaWxlIC9ldGMvc3NsL2NlcnRzL3ByaXZhdGVLZXkucGVtClNTTENlcnRpZmljYXRlRmlsZSAvZXRjL3NzbC9jZXJ0cy9jZXJ0aWZpY2F0ZUNoYWluLnBlbQpSZXdyaXRlRW5naW5lIG9uClJld3JpdGVSdWxlIF4vc2hzJCAvc2hzLyBbUl0KUmV3cml0ZVJ1bGUgXi95dHMkIC95dHMvIFtSXQpSZXdyaXRlUnVsZSBeL2FwcGxpY2F0aW9uaGlzdG9yeSQgL2FwcGxpY2F0aW9uaGlzdG9yeS8gW1JdClJld3JpdGVSdWxlIF4vamgkIC9qaC8gW1JdClJld3JpdGVSdWxlIF4vcm0kIC9ybS8gW1JdClJld3JpdGVSdWxlIF4vY2x1c3RlciQgL2NsdXN0ZXIvIFtSXQpQcm94eVBhc3NSZXZlcnNlIGh0dHBzOi8vc2VydmVyaG9zdG5hbWU6MTk0NDMvIGh0dHA6Ly9sb2NhbGhvc3Q6MTg4OTkvClByb3h5UGFzc1JldmVyc2UgaHR0cHM6Ly9zZXJ2ZXJob3N0bmFtZToxOTQ0My8gaHR0cHM6Ly9sb2NhbGhvc3Q6MTg4OTkvCjxMb2NhdGlvbiAiL3Byb3h5Ij4KICBQcm94eVBhc3MgImh0dHA6Ly9sb2NhbGhvc3Q6MTg4OTkvcHJveHkiIGNvbm5lY3Rpb250aW1lb3V0PTI1IHRpbWVvdXQ9MzAKICBBZGRPdXRwdXRGaWx0ZXJCeVR5cGUgU1VCU1RJVFVURSB0ZXh0L3RleHQgdGV4dC9odG1sIHRleHQvcGxhaW4gdGV4dC94bWwgdGV4dC9jc3MgYXBwbGljYXRpb24veC1qYXZhc2NyaXB0IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQgYXBwbGljYXRpb24vanNvbgogIFN1YnN0aXR1dGUgInN8aHR0cDovL0hPU1ROQU1FLkRPTUFJTk5BTUUuRlFETjo4MDgwL3Rlei11aS98L3Rlei90ZXotdWkvfG5xIgogIFN1YnN0aXR1dGUgInN8aHR0cDpcL1wvKGlwLS4qPzo4MDQyKXwvbm0vJDF8Igo8L0xvY2F0aW9uPgo8TG9jYXRpb24gIi9qaC8iPgogIFByb3h5UGFzcyAiaHR0cDovL2xvY2FsaG9zdDoxODg5OS9qaC8iIGNvbm5lY3Rpb250aW1lb3V0PTI1IHRpbWVvdXQ9MzAKICBBZGRPdXRwdXRGaWx0ZXJCeVR5cGUgU1VCU1RJVFVURSB0ZXh0L3RleHQgdGV4dC9odG1sIHRleHQvcGxhaW4gdGV4dC94bWwgdGV4dC9jc3MgYXBwbGljYXRpb24veC1qYXZhc2NyaXB0IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQgYXBwbGljYXRpb24vanNvbgogIFN1YnN0aXR1dGUgInN8W2hIXVtyUl1bZUVdW2ZGXT0nXC8oKD8hc3RhdGljKS4qPyknfGhyZWY9Jy9qaC8kMSd8IgogIFN1YnN0aXR1dGUgJ3N8W2hIXVtyUl1bZUVdW2ZGXT0iXC8oKD8hc3RhdGljKS4qPykifGhyZWY9Ii9qaC8kMSJ8Jwo8L0xvY2F0aW9uPgo8TG9jYXRpb25NYXRjaCAiXihcL25tXC8oPzxub2RlaXA+Lio6ODA0MilcLyg/PHVybD4uKikkKSI+CiAgUHJveHlQYXNzICJodHRwOi8vbG9jYWxob3N0OjE4ODk5LyIgY29ubmVjdGlvbnRpbWVvdXQ9MjUgdGltZW91dD0zMAo8L0xvY2F0aW9uTWF0Y2g+CjxMb2NhdGlvbiAiL3Nocy8iPgogIFByb3h5UGFzcyAiaHR0cDovL2xvY2FsaG9zdDoxODg5OS9zaHMvIiBjb25uZWN0aW9udGltZW91dD0yNSB0aW1lb3V0PTMwCiAgQWRkT3V0cHV0RmlsdGVyQnlUeXBlIFNVQlNUSVRVVEUgdGV4dC90ZXh0IHRleHQvaHRtbCB0ZXh0L3BsYWluIHRleHQveG1sIHRleHQvY3NzIGFwcGxpY2F0aW9uL3gtamF2YXNjcmlwdCBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0IGFwcGxpY2F0aW9uL2pzb24KICBTdWJzdGl0dXRlICdzfGhyZWY9Ii98aHJlZj0iL3Nocy98bnEnCiAgU3Vic3RpdHV0ZSAnc3xzcmM9Ii98c3JjPSIvc2hzL3xucScKICBTdWJzdGl0dXRlICdzfHVpUm9vdD0iInx1aVJvb3Q9Ii9zaHMifG5xJwogIFN1YnN0aXR1dGUgInN8c2V0VUlSb290KCcnKXxzZXRVSVJvb3QoJy9zaHMnKXxucSIKICBTdWJzdGl0dXRlICJzfGh0dHA6XC9cLyhpcC0uKj86ODA0Mil8L25tLyQxfCIKPC9Mb2NhdGlvbj4KPExvY2F0aW9uICIvc3RhdGljLyI+CiAgUHJveHlQYXNzICJodHRwOi8vbG9jYWxob3N0OjE4ODk5L3N0YXRpYy8iIGNvbm5lY3Rpb250aW1lb3V0PTI1IHRpbWVvdXQ9MzAKPC9Mb2NhdGlvbj4KPExvY2F0aW9uICIvYXBwbGljYXRpb25oaXN0b3J5LyI+CiAgUHJveHlQYXNzICJodHRwOi8vbG9jYWxob3N0OjE4ODk5L2FwcGxpY2F0aW9uaGlzdG9yeS8iIGNvbm5lY3Rpb250aW1lb3V0PTI1IHRpbWVvdXQ9MzAKICBBZGRPdXRwdXRGaWx0ZXJCeVR5cGUgU1VCU1RJVFVURSB0ZXh0L3RleHQgdGV4dC9odG1sIHRleHQvcGxhaW4gdGV4dC94bWwgdGV4dC9jc3MgYXBwbGljYXRpb24veC1qYXZhc2NyaXB0IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQgYXBwbGljYXRpb24vanNvbgogIFN1YnN0aXR1dGUgInN8W2hIXVtyUl1bZUVdW2ZGXT0nXC8oKD8hc3RhdGljKS4qPyknfGhyZWY9Jy95dHMvJDEnfCIKICBTdWJzdGl0dXRlICdzfFtoSF1bclJdW2VFXVtmRl09IlwvKCg/IXN0YXRpYykuKj8pInxocmVmPSIveXRzLyQxInwnCiAgU3Vic3RpdHV0ZSAic3xbaEhdW3JSXVtlRV1bZkZdPSdodHRwKHMpPzpcL1wvKC4qPzo4MDQyKSd8aHJlZj0nL25tLyQyLyd8IgogIFN1YnN0aXR1dGUgJ3N8W2hIXVtyUl1bZUVdW2ZGXT0iaHR0cChzKT86XC9cLyguKj86ODA0MikifGhyZWY9Ii9ubS8kMi8ifCcKICBTdWJzdGl0dXRlICJzfGh0dHA6Ly9IT1NUTkFNRS5ET01BSU5OQU1FLkZRRE46ODE4OC98L3l0cy98bnEiCiAgU3Vic3RpdHV0ZSAic3xodHRwOi8vSE9TVE5BTUUuRE9NQUlOTkFNRS5GUUROOjgwODgvfC9ybS98bnEiCiAgU3Vic3RpdHV0ZSAic3xodHRwOi8vSE9TVE5BTUUuRE9NQUlOTkFNRS5GUUROOjIwODg4L3Byb3h5L3wvcHJveHkvfG5xIgo8L0xvY2F0aW9uPgo8TG9jYXRpb24gIi95dHMvIj4KICBQcm94eVBhc3MgImh0dHA6Ly9sb2NhbGhvc3Q6MTg4OTkveXRzLyIgY29ubmVjdGlvbnRpbWVvdXQ9MjUgdGltZW91dD0zMAogIEFkZE91dHB1dEZpbHRlckJ5VHlwZSBTVUJTVElUVVRFIHRleHQvdGV4dCB0ZXh0L2h0bWwgdGV4dC9wbGFpbiB0ZXh0L3htbCB0ZXh0L2NzcyBhcHBsaWNhdGlvbi94LWphdmFzY3JpcHQgYXBwbGljYXRpb24vamF2YXNjcmlwdCBhcHBsaWNhdGlvbi9qc29uCiAgU3Vic3RpdHV0ZSAic3xbaEhdW3JSXVtlRV1bZkZdPSdcLygoPyFzdGF0aWMpLio/KSd8aHJlZj0nL3l0cy8kMSd8IgogIFN1YnN0aXR1dGUgJ3N8W2hIXVtyUl1bZUVdW2ZGXT0iXC8oKD8hc3RhdGljKS4qPykifGhyZWY9Ii95dHMvJDEifCcKICBTdWJzdGl0dXRlICJzfFtoSF1bclJdW2VFXVtmRl09J2h0dHAocyk/OlwvXC8oLio/OjgwNDIpJ3xocmVmPScvbm0vJDIvJ3wiCiAgU3Vic3RpdHV0ZSAnc3xbaEhdW3JSXVtlRV1bZkZdPSJodHRwKHMpPzpcL1wvKC4qPzo4MDQyKSJ8aHJlZj0iL25tLyQyLyJ8JwogIFN1YnN0aXR1dGUgInN8aHR0cDovL0hPU1ROQU1FLkRPTUFJTk5BTUUuRlFETjo4MTg4L3wveXRzL3xucSIKICBTdWJzdGl0dXRlICJzfGh0dHA6Ly9IT1NUTkFNRS5ET01BSU5OQU1FLkZRRE46ODA4OC98L3JtL3xucSIKICBTdWJzdGl0dXRlICJzfGh0dHA6Ly9IT1NUTkFNRS5ET01BSU5OQU1FLkZRRE46MjA4ODgvcHJveHkvfC9wcm94eS98bnEiCjwvTG9jYXRpb24+CjxMb2NhdGlvbiAiL3JtLyI+CiAgUHJveHlQYXNzICJodHRwOi8vbG9jYWxob3N0OjE4ODk5L3JtLyIgY29ubmVjdGlvbnRpbWVvdXQ9MjUgdGltZW91dD0zMAogIEFkZE91dHB1dEZpbHRlckJ5VHlwZSBTVUJTVElUVVRFIHRleHQvdGV4dCB0ZXh0L2h0bWwgdGV4dC9wbGFpbiB0ZXh0L3htbCB0ZXh0L2NzcyBhcHBsaWNhdGlvbi94LWphdmFzY3JpcHQgYXBwbGljYXRpb24vamF2YXNjcmlwdCBhcHBsaWNhdGlvbi9qc29uCiAgU3Vic3RpdHV0ZSAic3xbaEhdW3JSXVtlRV1bZkZdPSdcL1wvKGlwLS4qPzo4MDQyKSd8aHJlZj0nL25tLyQxLyd8IgogIFN1YnN0aXR1dGUgJ3N8W2hIXVtyUl1bZUVdW2ZGXT0iXC9cLyhpcC0uKj86ODA0MikifGhyZWY9Ii9ubS8kMS8ifCcKICBTdWJzdGl0dXRlICdzJVtoSF1bclJdW2VFXVtmRl09IlwvKCg/IXN0YXRpY3xubXxybSkuKj8pIiVocmVmPSIvcm0vJDEiJScKICBTdWJzdGl0dXRlICJzfFtoSF1bclJdW2VFXVtmRl09J2h0dHAocyk/OlwvXC8oLio/OjgwNDIpJ3xocmVmPScvbm0vJDIvJ3wiCiAgU3Vic3RpdHV0ZSAnc3xbaEhdW3JSXVtlRV1bZkZdPSJodHRwKHMpPzpcL1wvKC4qPzo4MDQyKSJ8aHJlZj0iL25tLyQyLyJ8JwogIFN1YnN0aXR1dGUgInN8W2hIXVtyUl1bZUVdW2ZGXT0naHR0cChzKT86XC9cLyguKjo4MDQyKVwvKC4qPyknfGhyZWY9Jy9ubS8kMi8kMyd8IgogIFN1YnN0aXR1dGUgJ3N8W2hIXVtyUl1bZUVdW2ZGXT0iaHR0cChzKT86XC9cLyguKjo4MDQyKVwvKC4qPykifGhyZWY9Ii9ubS8kMi8kMyJ8JwogIFN1YnN0aXR1dGUgInN8aHR0cDovL0hPU1ROQU1FLkRPTUFJTk5BTUUuRlFETjo4MDg4L3wvcm0vfG5xIgogIFN1YnN0aXR1dGUgInN8aHR0cDovL0hPU1ROQU1FLkRPTUFJTk5BTUUuRlFETjoyMDg4OC9wcm94eS98L3Byb3h5L3xucSIKPC9Mb2NhdGlvbj4KPExvY2F0aW9uICIvY2x1c3Rlci8iPgogIFByb3h5UGFzcyAiaHR0cDovL2xvY2FsaG9zdDoxODg5OS9jbHVzdGVyLyIgY29ubmVjdGlvbnRpbWVvdXQ9MjUgdGltZW91dD0zMAo8L0xvY2F0aW9uPgo8TG9jYXRpb24gIi90ZXovIj4KICBQcm94eVBhc3MgImh0dHA6Ly9sb2NhbGhvc3Q6MTg4OTkvdGV6LyIgY29ubmVjdGlvbnRpbWVvdXQ9MjUgdGltZW91dD0zMAo8L0xvY2F0aW9uPgo8L1ZpcnR1YWxIb3N0Pgo= |base64 -d > /home/hadoop/ssl.conf

sudo sed -i -e "s|serverhostname|$HOSTNAME|g" /home/hadoop/ssl.conf
sudo mv /home/hadoop/ssl.conf /etc/httpd/conf.d/ssl.conf
sudo sed -i -e "s|HOSTNAME.DOMAINNAME.FQDN|$HOSTNAME|g" /etc/httpd/conf.d/ssl.conf
sudo systemctl restart httpd.service
